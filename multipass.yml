#cloud-config

locale: en_US.UTF8
timezone: Asia/Tokyo
apt_mirror: http://jp.archive.ubuntu.com/ubuntu/

write_files:
 - path: /etc/netplan/99-custom.yaml
   content: |
    network:
      ethernets:
        enp6s0:
          dhcp4: false
          addresses: [ 192.168.3.10/24 ]
          gateway4: 192.168.0.1
          nameservers:
            addresses:
              - 192.168.0.1
              - 8.8.8.8
      version: 2

users:
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL

packages:
  - curl
  - zip
  - jq
  - wget
  - ca-certificates
  - curl
  - gnupg
  - lsb-release
  - build-essential
  - iptables-persistent

runcmd:
  - mkdir -p /etc/apt/keyrings
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
  - echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  - apt-get update && apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y
  - gpasswd -a ubuntu docker
  - [systemctl, daemon-reload]
  - sudo netplan apply
